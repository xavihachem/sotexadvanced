// Image Gallery with Auto-Rotate - Only Grouped Images
let currentImageIndex = 0;
const images = [
    '/images/grouped/present1.jpg',
    '/images/grouped/present2.jpg',
    '/images/grouped/image5.jpg',
    '/images/grouped/position3.jpg',
    '/images/grouped/position4.jpg'
];

// Change image function
function changeImage(src, index) {
    const mainImage = document.getElementById('mainImage');
    const imageCounter = document.getElementById('currentImageIndex');
    
    mainImage.style.opacity = '0';
    
    setTimeout(() => {
        mainImage.src = src;
        currentImageIndex = index;
        imageCounter.textContent = index + 1;
        
        const thumbnails = document.querySelectorAll('.thumbnail-img');
        thumbnails.forEach((thumb, i) => {
            if (i === index) {
                thumb.classList.remove('border-gray-200');
                thumb.classList.add('border-pink-500');
            } else {
                thumb.classList.remove('border-pink-500');
                thumb.classList.add('border-gray-200');
            }
        });
        
        mainImage.style.opacity = '1';
    }, 300);
}

function nextImage() {
    currentImageIndex = (currentImageIndex + 1) % images.length;
    changeImage(images[currentImageIndex], currentImageIndex);
}

function previousImage() {
    currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
    changeImage(images[currentImageIndex], currentImageIndex);
}

function autoRotateImages() {
    currentImageIndex = (currentImageIndex + 1) % images.length;
    changeImage(images[currentImageIndex], currentImageIndex);
}

let autoRotateInterval = setInterval(autoRotateImages, 6000);

document.addEventListener('DOMContentLoaded', () => {
    const mainImage = document.getElementById('mainImage');
    const imageContainer = mainImage.parentElement;
    
    mainImage.style.transition = 'opacity 0.3s ease-in-out, transform 0.5s ease';
    
    imageContainer.addEventListener('mouseenter', () => {
        clearInterval(autoRotateInterval);
    });
    
    imageContainer.addEventListener('mouseleave', () => {
        autoRotateInterval = setInterval(autoRotateImages, 6000);
    });
});

// Algerian phone number validation
function validatePhone() {
    const phoneInput = document.getElementById('phoneInput');
    const phoneError = document.getElementById('phoneError');
    const phoneSuccess = document.getElementById('phoneSuccess');
    const phoneValue = phoneInput.value.replace(/\s/g, '');
    
    const algerianPhonePattern = /^(05|06|07)[0-9]{8}$/;
    
    if (phoneValue.length === 0) {
        phoneError.classList.add('hidden');
        phoneSuccess.classList.add('hidden');
        phoneInput.classList.remove('border-red-500', 'border-green-500');
        return;
    }
    
    if (algerianPhonePattern.test(phoneValue)) {
        phoneError.classList.add('hidden');
        phoneSuccess.classList.remove('hidden');
        phoneInput.classList.remove('border-red-500');
        phoneInput.classList.add('border-green-500');
    } else {
        phoneError.classList.remove('hidden');
        phoneSuccess.classList.add('hidden');
        phoneInput.classList.remove('border-green-500');
        phoneInput.classList.add('border-red-500');
    }
}

// Delivery selection - FREE DELIVERY!
let selectedDeliveryType = 'home';

function selectDelivery(type) {
    selectedDeliveryType = type;
    
    const homeBtn = document.getElementById('homeDelivery');
    const officeBtn = document.getElementById('officeDelivery');
    
    if (type === 'home') {
        homeBtn.classList.remove('border-gray-300', 'bg-white');
        homeBtn.classList.add('border-pink-500', 'bg-gradient-to-br', 'from-pink-50', 'to-purple-50');
        homeBtn.querySelector('i').classList.remove('text-gray-500');
        homeBtn.querySelector('i').classList.add('text-pink-500');
        
        officeBtn.classList.remove('border-pink-500', 'bg-gradient-to-br', 'from-pink-50', 'to-purple-50');
        officeBtn.classList.add('border-gray-300', 'bg-white');
        officeBtn.querySelector('i').classList.remove('text-pink-500');
        officeBtn.querySelector('i').classList.add('text-gray-500');
    } else {
        officeBtn.classList.remove('border-gray-300', 'bg-white');
        officeBtn.classList.add('border-pink-500', 'bg-gradient-to-br', 'from-pink-50', 'to-purple-50');
        officeBtn.querySelector('i').classList.remove('text-gray-500');
        officeBtn.querySelector('i').classList.add('text-pink-500');
        
        homeBtn.classList.remove('border-pink-500', 'bg-gradient-to-br', 'from-pink-50', 'to-purple-50');
        homeBtn.classList.add('border-gray-300', 'bg-white');
        homeBtn.querySelector('i').classList.remove('text-pink-500');
        homeBtn.querySelector('i').classList.add('text-gray-500');
    }
}

function updatePriceByLength() {
    const quantity = parseInt(document.getElementById('lengthInput').value) || 1;
    const pricePerUnit = 5900;
    const discount = quantity >= 2 ? 500 : 0; // 500 DZD off total for 2+
    const productTotal = (quantity * pricePerUnit) - discount;
    
    document.getElementById('displayPrice').textContent = `${pricePerUnit.toLocaleString()} دينار`;
    document.getElementById('summaryPrice').textContent = `${productTotal.toLocaleString()} دينار`;
    
    updateTotal();
}

function updateTotal() {
    const quantity = parseInt(document.getElementById('lengthInput').value) || 1;
    const pricePerUnit = 5900;
    const discount = quantity >= 2 ? 500 : 0; // 500 DZD off total for 2+
    const productTotal = (quantity * pricePerUnit) - discount;
    // FREE DELIVERY - No delivery fee added!
    const total = productTotal;
    
    document.getElementById('totalPrice').textContent = `${total.toLocaleString()} دينار`;
}

// Complete Baladiyat data for all 58 Algerian wilayas
const baladiyatData = {
    '01': ['أدرار', 'تامست', 'شروين', 'رقان', 'إن زغمير', 'تيط', 'قصر قدور', 'تسابيت', 'فنوغيل', 'تيمياوين', 'تامنطيط', 'زاوية كنتة', 'أولاد أحمد تيمي', 'بودة', 'أقبلي', 'أولف', 'تيمقطن', 'تالمين', 'المطارفة', 'أولاد السعيد', 'السبع', 'أولاد عيسى', 'تيمادانين', 'أولاد أحمد تيمي'],
    '02': ['الشلف', 'تنس', 'بنايرية', 'الكريمية', 'تاجنة', 'تاوقريت', 'بني حوا', 'صبحة', 'حرشون', 'أولاد فارس', 'سيدي عكاشة', 'بوقادير', 'بني راشد', 'تلعصة', 'الهرانفة', 'وادي قوسين', 'الظهرة', 'أولاد عباس', 'سندي', 'زبوجة', 'وادي سلي', 'أبو الحسن', 'المرسى', 'الشطية', 'سيدي عبد الرحمن', 'موسى', 'أم الذروع', 'الأبيض مجاجة', 'وادي الفضة', 'أولاد بن عبد القادر', 'بوزغاية', 'عين مران', 'أولاد سيدي الميهوب', 'جديوية'],
    '03': ['الأغواط', 'قصر الحيران', 'بن ناصر بن شهرة', 'سيدي مخلوف', 'حاسي الدلاعة', 'حاسي الرمل', 'عين ماضي', 'تاجموت', 'قلتة سيدي سعد', 'عين سيدي علي', 'بيضاء', 'بريدة', 'الغيشة', 'الحويطة', 'سبقاق', 'تاويالة', 'أفلو', 'العسافية', 'وادي مرة', 'وادي مزي', 'الخنق', 'سيدي بوزيد', 'تاجرونة'],
    '04': ['أم البواقي', 'عين البيضاء', 'عين الكرشة', 'بحير الشرقي', 'عين فكرون', 'ضلعة', 'سيقوس', 'عين ببوش', 'أولاد حملة', 'مسكيانة', 'الرحية', 'الفجوج بوغرارة', 'عين الديس', 'فكيرينة', 'أولاد قاسم', 'الزرق', 'بلالة', 'سوق نعمان', 'حنشير توميات', 'أولاد زواي', 'بئر الشهداء', 'الأمير عبد القادر', 'عين ملوك', 'الفجوج', 'الحرمالية'],
    '05': ['باتنة', 'أريس', 'مروانة', 'تازولت', 'نقاوس', 'سريانة', 'منعة', 'المعذر', 'تكوت', 'عين التوتة', 'حيدوسة', 'رأس العيون', 'شمرة', 'عين جاسر', 'بريكة', 'جرمة', 'تيمقاد', 'قصر بلزمة', 'عزيل عبد القادر', 'جزار', 'تالخمت', 'بوزينة', 'عين ياقوت', 'فسديس', 'سقانة', 'إشمول', 'فم الطوب', 'بني فضالة الحقانية', 'الشعبة', 'أولاد سلام', 'تيغانمين', 'عيون العصافير', 'بومقر', 'بومية', 'أولاد فاضل', 'تيغرغار', 'عين الديس', 'ثنية العابد', 'أولاد عوف', 'الحاسي', 'كيمل', 'لازرو', 'بوحمامة', 'أولاد سي سليمان', 'أولاد عمار', 'الرحبات', 'تاكسلانت', 'قيقبة', 'إنوغيسن', 'أولاد معوف'],
    '06': ['بجاية', 'أميزور', 'فرعون', 'سيدي عيش', 'تاوريرت إيغيل', 'شلاطة', 'سوق الاثنين', 'أمالو', 'سدوق', 'تيشي', 'تمقرة', 'إيفري', 'أقبو', 'بني مليكش', 'تيمزريت', 'أدكار', 'أوزلاقن', 'بوحمزة', 'بوجليل', 'تالة حمزة', 'إغرام', 'أيت رزين', 'تيفرا', 'إغيل علي', 'فناية', 'بني جليل', 'بني معوش', 'أيت سماعيل', 'أكفادو', 'لفلاي', 'بني كسيلة', 'أوقاس', 'تيزي نبربر', 'برباشة', 'تامريجت', 'إيفري أوزلاقن', 'بوخليفة', 'تاسكريوت', 'شميني', 'تينبدار', 'سوق أوفلا', 'أيت جليل', 'أكبو', 'بني دوالة', 'بني زيكي', 'درقينة', 'أيت يحيى', 'أيت محمود', 'أيت خليلي', 'أيت يعقوب', 'فريحة'],
    '07': ['بسكرة', 'أورلال', 'جمورة', 'مزيرعة', 'سيدي عقبة', 'سيدي خالد', 'طولقة', 'أوماش', 'براقي', 'فوغالة', 'بوشقرون', 'مشونش', 'الحاجب', 'الزريبة الوادي', 'ليوة', 'أولاد جلال', 'الشعيبة', 'الغروس', 'خنقة سيدي ناجي', 'القنطرة', 'عين الناقة', 'الدوسن', 'الحوش', 'أولاد ساسي', 'الفيض', 'شتمة', 'أولاد عاشور', 'مليلي', 'عين زعطوط'],
    '08': ['بشار', 'بني ونيف', 'بني عباس', 'القنادسة', 'العبادلة', 'تاغيت', 'بوكايس', 'موغل', 'عبد الكريم', 'كرزاز', 'تامترت', 'إقلي', 'تابلبالة', 'بوسمغون', 'لحمر', 'العويسات', 'تيمودي', 'أولاد خضير', 'المشرية'],
    '09': ['البليدة', 'الشفة', 'بوعينان', 'الأربعاء', 'بوقرة', 'سوحان', 'بوفاريك', 'أولاد يعيش', 'الشريعة', 'موزاية', 'أولاد سلامة', 'واد العلايق', 'بني تامو', 'بني مراد', 'بوعرفة', 'العفرون', 'حمام ملوان', 'بن خليل', 'الصومعة', 'مفتاح', 'واد جر'],
    '10': ['البويرة', 'سور الغزلان', 'الأخضرية', 'برج خريص', 'القادرية', 'عين بسام', 'بشلول', 'بئر غبالو', 'الهاشمية', 'أهل القصر', 'حيزر', 'تاغزوت', 'رابطة', 'المعمورة', 'الأسنام', 'عين العلوي', 'عين تركي', 'أولاد راشد', 'أيت لازيز', 'بوعرفة', 'بني سليمان', 'عمر', 'الديسة', 'أولاد سيدي إبراهيم', 'سحاريج'],
    '11': ['تمنراست', 'أبلسة', 'إن قزام', 'تاظروك', 'إن أمقل', 'عين أمقل', 'إدلس', 'تين زاوتين', 'عين صالح', 'فقارة الزوى'],
    '12': ['تبسة', 'بئر العاتر', 'الشريعة', 'الماء الأبيض', 'نقرين', 'بير المقدم', 'العقلة', 'الحمامات', 'ونزة', 'الكويف', 'مرسط', 'أم علي', 'فركان', 'بوخضرة', 'الونزة', 'الحويجبات', 'الزاوية', 'الحمرايا', 'بئر الذهب', 'العقلة المالحة', 'بوكحيل', 'بجن', 'سطح قنطيس', 'بئر مقدم', 'العقلة', 'الونزة', 'الشريعة', 'الماء الأبيض'],
    '13': ['تلمسان', 'شتوان', 'المنصورة', 'بني مستار', 'عين تالوت', 'الرمشي', 'مغنية', 'صبرة', 'ندرومة', 'هنين', 'بني بوسعيد', 'الغزوات', 'سوق الثلاثاء', 'أولاد ميمون', 'عين فزة', 'أولاد رياح', 'مسيردة', 'بوحلو', 'سيدي الجيلالي', 'سبعة شيوخ', 'تيرني بني هديل', 'بني صميل', 'عين الكبيرة', 'سيدي مجاهد', 'عين يوسف', 'بني ورسوس', 'بني بهدل', 'سيدي العبدلي', 'عزايل', 'القور', 'الحناية', 'تيانت', 'بني خلاد', 'بني سنوس', 'سيدي عبد الله', 'دار يغمراسن', 'فلاوسن', 'عين النحالة', 'الحمام', 'مرسى بن مهيدي', 'بني بوسعيد', 'بني ورسوس', 'بني خلاد', 'سوق الثلاثاء', 'أولاد ميمون', 'عين فزة', 'الغزوات', 'صبرة', 'بني صميل', 'بني بهدل', 'سيدي الجيلالي', 'سبعة شيوخ'],
    '14': ['تيارت', 'مهدية', 'عين الذهب', 'رحوية', 'مشرع الصفا', 'قرطوفة', 'سوقر', 'عين كرمس', 'فرندة', 'السبت', 'مدروسة', 'جيلالي بن عمار', 'عين بوشقيف', 'سيدي علي ملال', 'سيدي بختي', 'سيدي عبد الغني', 'سرغين', 'زمالة الأمير عبد القادر', 'تاقدمت', 'عين زارت', 'الرحوية', 'قصر الشلالة', 'ملاكو', 'سيدي حسني', 'عين الحديد', 'نادورة', 'تاخمرت', 'شحيمة', 'مدروسة', 'فرندة', 'رحوية', 'مشرع الصفا', 'قرطوفة', 'سوقر', 'عين الذهب', 'مهدية', 'السبت', 'الدحراوية', 'جيلالي بن عمار', 'عين كرمس', 'سيدي بختي', 'تاقدمت'],
    '15': ['تيزي وزو', 'عين الحمام', 'أقني قغران', 'إفرحونن', 'عزازقة', 'تيغزيرت', 'تيزي راشد', 'واضية', 'مقلع', 'تيمزريت', 'مشترة', 'أيت بومهدي', 'أقبو', 'إفيغاء', 'بوغني', 'إليلتن', 'بوزقن', 'أيت عيسى ميمون', 'أكبيل', 'بني دوالة', 'بني زيكي', 'درقينة', 'أيت يحيى', 'أيت محمود', 'أيت خليلي', 'أيت يعقوب', 'فريحة', 'سوق الاثنين', 'يطافن', 'أيت عقوشة', 'أيت بوعدو', 'تيرورضا', 'إيلولة أومالو', 'بني زمنزر', 'أيت أومالو', 'تيزي نثلاثة', 'بوجيمة', 'أيت يحيى موسى', 'مقلع', 'تيمزريت', 'مشترة', 'أيت بومهدي', 'أقبو', 'إفيغاء', 'بوغني', 'إليلتن', 'بوزقن', 'أيت عيسى ميمون', 'أكبيل', 'إفرحونن', 'بني دوالة', 'بني زيكي', 'درقينة', 'أيت يحيى', 'أيت محمود', 'أيت خليلي', 'أيت يعقوب', 'فريحة', 'سوق الاثنين', 'يطافن', 'أيت عقوشة', 'أيت بوعدو', 'تيرورضا', 'إيلولة أومالو', 'بني زمنزر'],
    '16': ['الجزائر الوسطى', 'سيدي محمد', 'العناصر', 'باب الوادي', 'بولوغين', 'القصبة', 'حسين داي', 'المدنية', 'الحراش', 'برج الكيفان', 'بئر مراد رايس', 'بئر خادم', 'باب الزوار', 'بن عكنون', 'الدار البيضاء', 'الشراقة', 'عين البنيان', 'المحمدية', 'بوزريعة', 'بئر توتة', 'باش جراح', 'الأبيار', 'بوروبة', 'الحمامات', 'رويبة', 'ريغاية', 'عين طاية', 'حرواة', 'براقي', 'سيدي موسى', 'بودواو', 'الرويبة', 'رغاية', 'سوسطارة', 'الدويرة', 'المرادية', 'الرايس حميدو', 'بئر خادم', 'بئر مراد رايس', 'برج الكيفان', 'الحراش', 'حسين داي', 'القصبة', 'بولوغين', 'باب الوادي', 'العناصر', 'باب الزوار', 'بن عكنون', 'الدار البيضاء', 'بوزريعة', 'بئر توتة', 'باش جراح', 'الأبيار', 'عين طاية', 'حرواة', 'براقي', 'سيدي موسى', 'بودواو'],
    '17': ['الجلفة', 'مسعد', 'حد الصحاري', 'عين معبد', 'عين الإبل', 'تعظميت', 'دار الشيوخ', 'البيرين', 'فيض البطمة', 'سيدي بايزيد', 'عين فكة', 'أم العظام', 'حاسي بحبح', 'سيدي لعجال', 'عين وسارة', 'القديد', 'عمورة', 'الشارف', 'الإدريسية', 'بن هار', 'حاسي فدول', 'سد الرحال', 'زكار', 'عين الشهداء', 'الدويس', 'حاسي بحبح', 'عين معبد', 'عين الإبل', 'تعظميت', 'دار الشيوخ', 'البيرين', 'فيض البطمة', 'سيدي بايزيد', 'عين فكة', 'أم العظام', 'مسعد', 'حد الصحاري'],
    '18': ['جيجل', 'العوانة', 'الطاهير', 'الشقفة', 'الميلية', 'سيدي معروف', 'السطارة', 'الأمير عبد القادر', 'زيامة منصورية', 'القنار', 'بودريعة بن ياجيس', 'جيملة', 'سلمى بن زيادة', 'بني حبيبي', 'القاوس', 'غبالة', 'بوسيف أولاد عسكر', 'العنصر', 'تاكسنة', 'الشقفة', 'بودريعة بن ياجيس', 'جيملة', 'سلمى بن زيادة', 'بني حبيبي', 'القاوس', 'غبالة', 'بوسيف أولاد عسكر', 'العنصر'],
    '19': ['سطيف', 'عين الكبيرة', 'بني عزيز', 'أولاد صابر', 'بوقاع', 'العلمة', 'عين أرنات', 'عين ولمان', 'بني ورتيلان', 'عموشة', 'بابور', 'قجال', 'حمام قرقور', 'مزلوق', 'بني فودة', 'تاكسلانت', 'بئر الحدادة', 'صالح باي', 'عين عباسة', 'عين الروى', 'تيزي نبشار', 'الأوريسية', 'تالة إيفاسن', 'بوعنداس', 'بوسلام', 'أولاد تبان', 'رصفة', 'أولاد عدوان', 'بني موحلي', 'قلتة زرقاء', 'عين الحجر', 'مجانة', 'بني ورثيلان', 'عموشة', 'بابور', 'قجال', 'حمام قرقور', 'مزلوق', 'بني فودة', 'تاكسلانت', 'بئر الحدادة', 'صالح باي', 'عين عباسة', 'عين الروى', 'تيزي نبشار', 'عين الكبيرة', 'بني عزيز', 'أولاد صابر', 'بوقاع', 'العلمة', 'عين أرنات', 'عين ولمان', 'الأوريسية', 'تالة إيفاسن', 'بوعنداس', 'بوسلام', 'أولاد تبان', 'رصفة'],
    '20': ['سعيدة', 'دوي ثابت', 'عين الحجر', 'سيدي أحمد', 'عين السخونة', 'يوب', 'حساسنة', 'سيدي بوبكر', 'الحساسنة', 'مولاي العربي', 'تيرسين', 'عين الحديد', 'أولاد خالد', 'سيدي عمر', 'سيدي أحمد', 'عين السخونة'],
    '21': ['سكيكدة', 'عزابة', 'القل', 'الحروش', 'الحدائق', 'فلفلة', 'الفجوج', 'تمالوس', 'عين قشرة', 'بني ولبان', 'أولاد عطية', 'عين بوزيان', 'الزيتونة', 'بني بشير', 'سيدي مزغيش', 'عين شرشار', 'أولاد حبابة', 'الشرايع', 'بني زيد', 'عين كشرة', 'بكوش', 'قنواع', 'الغدير', 'بين الويدان', 'الزردزاس', 'عمارة بن عودة', 'صلاح الدين', 'القل', 'عزابة', 'الحروش', 'الحدائق', 'فلفلة', 'الفجوج', 'تمالوس', 'عين قشرة', 'بني ولبان', 'أولاد عطية', 'عين بوزيان'],
    '22': ['سيدي بلعباس', 'تسالة', 'سيدي براهيم', 'مصطفى بن براهيم', 'تلاغ', 'سيدي علي بوسيدي', 'سفيزف', 'عين ثريد', 'مرحوم', 'تنيرة', 'بن بادس', 'سيدي حمادوش', 'مكرة', 'سيدي يحيى', 'الحساسنة', 'عين تريد', 'عين الطلبة', 'عين تاغروت', 'بوجبهة', 'الضاية', 'حساسنة', 'لمطار', 'مولاي سليسن', 'أولاد براهيم', 'رأس الماء', 'سيدي خالد', 'سيدي علي بن يوب', 'سيدي لحسن', 'سيدي يعقوب', 'تافسرة', 'تلاغ', 'تنيرة', 'زروالة', 'عمارنة', 'عين تريد', 'عين الطلبة', 'عين تاغروت', 'بوجبهة', 'الضاية', 'حساسنة', 'لمطار', 'تسالة', 'سيدي براهيم', 'مصطفى بن براهيم', 'تلاغ', 'سيدي علي بوسيدي', 'سفيزف', 'عين ثريد', 'مرحوم', 'تنيرة', 'بن بادس'],
    '23': ['عنابة', 'برحال', 'سرايدي', 'عين الباردة', 'الشط', 'سيدي عمار', 'الحجار', 'عين البيضاء', 'الذرعان', 'الحجار', 'سيدي عمار', 'الشط', 'عين الباردة'],
    '24': ['قالمة', 'بوشقوف', 'الحلفاء', 'بوحمدان', 'بن جراح', 'خزارة', 'حمام دباغ', 'عين بن بيضاء', 'عين العربي', 'عين مخلوف', 'عين الرقراق', 'بوحاتم', 'عين لاربع', 'بوسيف', 'حمام النبايل', 'بوشقوف', 'الحلفاء', 'بوحمدان', 'بن جراح', 'خزارة', 'حمام دباغ', 'بوماهرة', 'الفجوج', 'قرفة', 'رأس العقبة', 'بلخير', 'هليوبوليس', 'أولاد عطية', 'عين بن بيضاء', 'عين العربي', 'عين مخلوف', 'عين الرقراق', 'بوحاتم', 'عين لاربع', 'بوسيف'],
    '25': ['قسنطينة', 'عين أعبيد', 'زيغود يوسف', 'الخروب', 'عين السمارة', 'ديدوش مراد', 'حامة بوزيان', 'بن باديس', 'مسعود بوجريو', 'عين أعبيد', 'زيغود يوسف', 'الخروب', 'عين السمارة'],
    '26': ['المدية', 'أولاد عنتر', 'سي المحجوب', 'بني سليمان', 'قصر البخاري', 'شلالة العذاورة', 'عزيز', 'الأمير عبد القادر', 'البرواقية', 'سغوان', 'الحوامد', 'تابلاط', 'بوسكن', 'خمس جوامع', 'عين بوسيف', 'الربعية', 'جواب', 'بوغار', 'الشهبونية', 'الذراعية', 'الدامية', 'عين القصير', 'عين أوسارة', 'بوعيش', 'الزبيرية', 'سيدي زيان', 'سيدي نعمان', 'سيدي الربيع', 'تيزي المهدي', 'عين بوشقيف', 'عين الحجل', 'عين الدهب', 'قصر البخاري', 'شلالة العذاورة', 'عزيز', 'الأمير عبد القادر', 'البرواقية', 'سغوان', 'الحوامد', 'تابلاط', 'بوسكن', 'خمس جوامع', 'عين بوسيف', 'الربعية', 'بني سليمان', 'سي المحجوب', 'أولاد عنتر'],
    '27': ['مستغانم', 'عين تادلس', 'حاسي ماماش', 'فروحة', 'سيدي علي', 'عين النويسي', 'صور', 'سيدي لخضر', 'عشعاشة', 'خير الدين', 'سيدي بلعطار', 'بوقيرات', 'حجاج', 'الحسيان', 'مزغران', 'سيدي بن ذهيبة', 'عين بوداود', 'سور', 'عين سيدي الشريف', 'سيدي عكاشة', 'حاسي ماماش', 'عين تادلس', 'حاسي ماماش', 'فروحة', 'سيدي علي', 'عين النويسي', 'صور', 'سيدي لخضر', 'عشعاشة', 'خير الدين', 'سيدي بلعطار', 'بوقيرات'],
    '28': ['المسيلة', 'بوسعادة', 'سيدي عيسى', 'عين الملح', 'عين الحجل', 'عين الخضراء', 'بن سرور', 'أولاد دراج', 'المعاضيد', 'سيدي هجرس', 'المطارفة', 'الهامل', 'أولاد عدي لقبالة', 'بئر فضة', 'تامسة', 'الحوامد', 'أولاد سليمان', 'بوطي السايح', 'جبل مساعد', 'مقرة', 'سيدي عامر', 'سيدي محمد', 'عين فارس', 'عين الريش', 'بن سرور', 'أولاد دراج', 'المعاضيد', 'سيدي هجرس', 'المطارفة', 'الهامل', 'أولاد عدي لقبالة', 'بئر فضة', 'تامسة', 'الحوامد', 'أولاد سليمان', 'بوطي السايح', 'جبل مساعد', 'بوسعادة', 'سيدي عيسى', 'عين الملح', 'عين الحجل', 'عين الخضراء'],
    '29': ['معسكر', 'بوحنيفية', 'تيغنيف', 'تيزي', 'عين فارس', 'عين فكة', 'سيق', 'عين فراح', 'الغمري', 'الحشم', 'سيدي عبد الجبار', 'الحمادنة', 'المأمونية', 'المنور', 'عوف', 'فروحة', 'قرطوفة', 'ماوسة', 'مشرع عسفة', 'نسمط', 'سيدي بوسعيد', 'سيدي قادة', 'زهانة', 'عين فارس', 'عين فكة', 'سيق', 'عين فراح', 'الغمري', 'الحشم', 'سيدي عبد الجبار', 'بوحنيفية', 'تيغنيف', 'تيزي', 'عين فارس', 'عين فكة', 'سيق', 'عين فراح', 'الغمري', 'الحشم', 'سيدي عبد الجبار', 'الحمادنة', 'المأمونية', 'المنور'],
    '30': ['ورقلة', 'حاسي مسعود', 'تقرت', 'تماسين', 'تويقرت', 'النقوسة', 'الحجيرة', 'الرويسات', 'عين البيضاء', 'سيدي خويلد', 'حاسي بن عبد الله', 'حاسي مسعود', 'تقرت', 'تماسين', 'تويقرت', 'النقوسة', 'الحجيرة', 'الرويسات', 'عين البيضاء', 'سيدي خويلد', 'حاسي بن عبد الله'],
    '31': ['وهران', 'السانية', 'عين الترك', 'بئر الجير', 'حاسي بونيف', 'حاسي مفسوخ', 'مرسى الحجاج', 'بوتليليس', 'عين الكرمة', 'أرزيو', 'بطيوة', 'بوسفر', 'قديل', 'طفراوي', 'سيدي الشحمي', 'عين البية', 'السانية', 'عين الترك', 'بئر الجير', 'حاسي بونيف', 'حاسي مفسوخ', 'مرسى الحجاج', 'بوتليليس', 'عين الكرمة', 'أرزيو', 'بطيوة', 'بوسفر'],
    '32': ['البيض', 'بوقطب', 'الأبيض سيدي الشيخ', 'بريزينة', 'الغاسول', 'الكاف الأحمر', 'عين الحجل', 'بوسمغون', 'شلالة', 'كراكدة', 'الأغواط', 'بوقطب', 'الأبيض سيدي الشيخ', 'بريزينة', 'الغاسول', 'الكاف الأحمر', 'عين الحجل', 'بوسمغون', 'شلالة', 'كراكدة', 'الأغواط', 'سيدي سليمان'],
    '33': ['إليزي', 'جانت', 'برج عمر إدريس', 'الدبداب'],
    '34': ['برج بوعريريج', 'رأس الوادي', 'برج زمورة', 'المنصورة', 'الماين', 'عين تاغروت', 'بئر قاصد علي', 'الحمادية', 'المهير', 'تقلعيت', 'الرابطة', 'الأشعاشعة', 'بن داود', 'الجعافرة', 'القصور', 'تاسمرت', 'عين تسرة', 'بئر قاصد علي', 'الحمادية', 'المهير', 'تقلعيت', 'الرابطة', 'الأشعاشعة', 'بن داود', 'الجعافرة', 'القصور', 'تاسمرت', 'عين تسرة', 'الماين', 'عين تاغروت', 'رأس الوادي', 'برج زمورة', 'المنصورة'],
    '35': ['بومرداس', 'الثنية', 'بودواو', 'أولاد موسى', 'برج منايل', 'بغلية', 'سيدي داود', 'نصر الدين', 'جنات', 'الخروبة', 'تيجلابين', 'عمال', 'بني عمران', 'سوق الحد', 'قورصو', 'أولاد عيسى', 'الأربعطاش', 'حمادي', 'خميس الخشنة', 'ليقاطة', 'الثنية', 'بودواو', 'أولاد موسى', 'برج منايل', 'بغلية', 'سيدي داود', 'نصر الدين', 'جنات', 'الخروبة', 'تيجلابين', 'عمال', 'بني عمران'],
    '36': ['الطارف', 'بوحجار', 'بن مهيدي', 'البسباس', 'بوقوس', 'الشافية', 'الذرعان', 'عصفور', 'عين الكرمة', 'بوثلجة', 'الشط', 'القالة', 'عين العسل', 'الزيتونة', 'زريزر', 'بوحجار', 'بن مهيدي', 'البسباس', 'بوقوس', 'الشافية', 'الذرعان', 'عصفور', 'عين الكرمة', 'بوثلجة'],
    '37': ['تندوف', 'أم العسل'],
    '38': ['تيسمسيلت', 'ثنية الأحد', 'بورڨاد', 'الأمارية', 'لرجام', 'مليانة', 'سيدي العنتري', 'لعزيزية', 'برج بونعامة', 'سيدي بوتوشنت', 'خميستي', 'يوسفية', 'سيدي سليمان', 'ثنية الأحد', 'بورڨاد', 'الأمارية', 'لرجام', 'مليانة', 'سيدي العنتري', 'لعزيزية', 'برج بونعامة', 'سيدي بوتوشنت', 'خميستي', 'يوسفية', 'سيدي سليمان'],
    '39': ['الوادي', 'الدبيلة', 'حاسي خليفة', 'الطالب العربي', 'دوار الماء', 'حساني عبد الكريم', 'المقرن', 'النخلة', 'قمار', 'الرباح', 'كوينين', 'مرارة', 'تندلة', 'سيدي عون', 'الطريفاوي', 'بن قشة', 'المغير', 'سيدي عمران', 'الدبيلة', 'حاسي خليفة', 'الطالب العربي', 'دوار الماء', 'حساني عبد الكريم', 'المقرن', 'النخلة', 'قمار', 'الرباح', 'كوينين', 'مرارة', 'تندلة'],
    '40': ['خنشلة', 'متوسة', 'قايس', 'بابار', 'عين الطويلة', 'تاملاحت', 'الحامة', 'شليعة', 'يابوس', 'خيران', 'أولاد رشاش', 'الولجة', 'بوحمامة', 'المحمل', 'أنسيغة', 'متوسة', 'قايس', 'بابار', 'عين الطويلة', 'تاملاحت', 'الحامة', 'شليعة', 'يابوس', 'خيران'],
    '41': ['سوق أهراس', 'سدراتة', 'مشروحة', 'أم العظائم', 'تاورة', 'زعرورية', 'تيفاش', 'عين الزانة', 'الحدادة', 'مداوروش', 'بئر بوحوش', 'الدريعة', 'الزوابي', 'أولاد إدريس', 'الويلان', 'خميسة', 'أولاد مؤمن', 'سدراتة', 'مشروحة', 'أم العظائم', 'تاورة', 'زعرورية', 'تيفاش', 'عين الزانة', 'الحدادة', 'مداوروش'],
    '42': ['تيبازة', 'القليعة', 'حجوط', 'شرشال', 'دموس', 'بوهارون', 'بوركيكة', 'سيدي غيلاس', 'حمر العين', 'الدويرة', 'بوسماعيل', 'سيدي راشد', 'سيدي أعمر', 'فوكة', 'بني ميلك', 'عطاف', 'القليعة', 'حجوط', 'شرشال', 'دموس', 'بوهارون', 'بوركيكة', 'سيدي غيلاس', 'حمر العين', 'الدويرة'],
    '43': ['ميلة', 'فرجيوة', 'الشلغوم العيد', 'تاجنانت', 'سيدي مروان', 'أولاد خلوف', 'تلاغمة', 'بوحاتم', 'رواشد', 'الرواشد', 'سيدي خليفة', 'عين البيضاء', 'عين مليلة', 'عين تين', 'أحمد راشدي', 'الماين', 'تسالة لمطاعي', 'قرارم قوقة', 'فرجيوة', 'الشلغوم العيد', 'تاجنانت', 'سيدي مروان', 'أولاد خلوف', 'تلاغمة', 'بوحاتم', 'رواشد', 'الرواشد', 'سيدي خليفة', 'عين البيضاء', 'عين مليلة', 'عين تين', 'أحمد راشدي'],
    '44': ['عين الدفلى', 'خميس مليانة', 'روينة', 'الأبادية', 'الشطية', 'العامرة', 'بورنان', 'الحمري', 'جندل', 'عين الحلوة', 'عين بنيان', 'عين الإبل', 'عين السلطان', 'بني راشد', 'بئر أولاد خليفة', 'حمام ريغة', 'الدشمية', 'ذراع الميزان', 'جندل', 'عين الحلوة', 'عين بنيان', 'عين الإبل', 'عين السلطان', 'بني راشد', 'بئر أولاد خليفة', 'حمام ريغة', 'الدشمية', 'ذراع الميزان', 'خميس مليانة', 'روينة', 'الأبادية', 'الشطية', 'العامرة', 'بورنان', 'الحمري'],
    '45': ['النعامة', 'المشرية', 'عين الصفراء', 'تيوت', 'صفيصيفة', 'مكمن بن عمار', 'عسلة', 'القصدير', 'الشهبونية', 'المشرية', 'عين الصفراء', 'تيوت', 'صفيصيفة', 'مكمن بن عمار', 'عسلة', 'القصدير', 'الشهبونية'],
    '46': ['عين تموشنت', 'حمام بوحجر', 'بوزجار', 'العامرية', 'سيدي بن عدة', 'أولاد بوجمعة', 'عين الكيحل', 'الملاح', 'سيدي بوعمامة', 'بني صاف', 'وادي الصباح', 'عين الأربعاء', 'الحساسنة', 'تموشنت', 'شعبة اللحم', 'سيدي سعيد', 'حمام بوحجر', 'بوزجار', 'العامرية', 'سيدي بن عدة', 'أولاد بوجمعة', 'عين الكيحل', 'الملاح', 'سيدي بوعمامة', 'بني صاف', 'وادي الصباح', 'عين الأربعاء', 'الحساسنة', 'تموشنت', 'شعبة اللحم', 'سيدي سعيد'],
    '47': ['غرداية', 'المنيعة', 'زلفانة', 'متليلي', 'بريان', 'المنصورة', 'حاسي الفحل', 'حاسي القارة', 'بونورة', 'الڨرارة', 'المنيعة', 'زلفانة', 'متليلي', 'بريان', 'المنصورة', 'حاسي الفحل', 'حاسي القارة', 'بونورة', 'الڨرارة'],
    '48': ['غليزان', 'وادي رهيو', 'جديوية', 'يلل', 'مازونة', 'سيدي محمد بن علي', 'عين طارق', 'الرمكة', 'بلدية عمي موسى', 'سيدي سعادة', 'بوقعدة', 'حد الشكالة', 'سيدي خطاب', 'عين الرحمة', 'وادي السلي', 'الحمادنة', 'بني زنطيس', 'وادي رهيو', 'جديوية', 'يلل', 'مازونة', 'سيدي محمد بن علي', 'عين طارق', 'الرمكة', 'بلدية عمي موسى', 'سيدي سعادة', 'بوقعدة', 'حد الشكالة', 'سيدي خطاب', 'عين الرحمة', 'وادي السلي', 'الحمادنة', 'بني زنطيس'],
    '49': ['تيميمون', 'شروين', 'أولاد السعيد', 'أولاد عيسى', 'تالمين', 'قصر قدور', 'أقبلي', 'أولاد أحمد تيمي', 'تيميمون', 'شروين'],
    '50': ['برج باجي مختار', 'تيمياوين', 'برج الحواس'],
    '51': ['أولاد جلال', 'سيدي خليل'],
    '52': ['بني عباس', 'تامترت', 'القنادسة', 'بني عباس'],
    '53': ['عين صالح', 'فقارة الزوى'],
    '54': ['عين قزام', 'تيمياوين'],
    '55': ['تقرت', 'تماسين', 'النقوسة', 'بليدة عمر', 'الحجيرة', 'الزاوية العابدية'],
    '56': ['جانت', 'برج الحواس'],
    '57': ['المغير', 'سيدي عمران'],
    '58': ['المنيعة', 'حاسي القارة']
};

// Update Baladiyat based on selected Wilaya
function updateBaladiyat() {
    const wilayaSelect = document.getElementById('wilayaSelect');
    const baladiyaSelect = document.getElementById('baladiyaSelect');
    const selectedWilaya = wilayaSelect.value;
    
    baladiyaSelect.innerHTML = '<option value="">البلدية</option>';
    
    if (selectedWilaya && baladiyatData[selectedWilaya]) {
        baladiyatData[selectedWilaya].forEach(baladiya => {
            const option = document.createElement('option');
            option.value = baladiya;
            option.textContent = baladiya;
            baladiyaSelect.appendChild(option);
        });
    }
}

// Success Modal Functions
function showSuccessModal() {
    const modal = document.getElementById('successModal');
    const modalContent = document.getElementById('modalContent');
    const orderNumber = 'SO-' + Math.floor(10000 + Math.random() * 90000);
    document.getElementById('orderNumber').textContent = '#' + orderNumber;
    
    modal.classList.remove('hidden');
    setTimeout(() => {
        modalContent.classList.remove('scale-95', 'opacity-0');
        modalContent.classList.add('scale-100', 'opacity-100');
    }, 10);
}

function closeSuccessModal() {
    const modal = document.getElementById('successModal');
    const modalContent = document.getElementById('modalContent');
    
    // Track Facebook Pixel Purchase event
    if (typeof fbq !== 'undefined') {
        const quantity = parseInt(document.getElementById('lengthInput').value) || 1;
        const pricePerUnit = 5900;
        const discount = quantity >= 2 ? 500 : 0;
        const productTotal = (quantity * pricePerUnit) - discount;
        
        fbq('track', 'Purchase', {
            value: productTotal,
            currency: 'DZD',
            content_name: 'مجموعة أدوات العناية والتجميل الفاخرة',
            content_type: 'product',
            num_items: quantity
        });
    }
    
    modalContent.classList.remove('scale-100', 'opacity-100');
    modalContent.classList.add('scale-95', 'opacity-0');
    
    setTimeout(() => {
        modal.classList.add('hidden');
    }, 300);
}

// Close modal on background click
document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('successModal');
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            closeSuccessModal();
        }
    });
});

// Form submission with email integration
document.addEventListener('DOMContentLoaded', () => {
    document.querySelector('form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = {
            name: document.querySelector('input[placeholder="الاسم الكامل"]').value,
            phone: document.getElementById('phoneInput').value,
            wilaya: document.getElementById('wilayaSelect').options[document.getElementById('wilayaSelect').selectedIndex].text,
            baladiya: document.getElementById('baladiyaSelect').value,
            deliveryType: selectedDeliveryType,
            area: document.getElementById('lengthInput').value,
            total: document.getElementById('totalPrice').textContent
        };
        
        const phonePattern = /^(05|06|07)[0-9]{8}$/;
        if (!phonePattern.test(formData.phone.replace(/\s/g, ''))) {
            alert('الرجاء إدخال رقم هاتف جزائري صحيح');
            return;
        }
        
        if (!formData.name || !formData.wilaya || !formData.baladiya) {
            alert('الرجاء ملء جميع الحقول المطلوبة');
            return;
        }
        
        try {
            const submitBtn = document.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> جاري الإرسال...';
            submitBtn.disabled = true;
            
            const response = await fetch('/api/order', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });
            
            const result = await response.json();
            
            if (result.success) {
                showSuccessModal();
                document.querySelector('form').reset();
                document.getElementById('phoneSuccess').classList.add('hidden');
                document.getElementById('phoneInput').classList.remove('border-green-500');
            } else {
                alert('❌ ' + result.message);
            }
            
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
            
        } catch (error) {
            console.error('Error:', error);
            alert('حدث خطأ في إرسال الطلب. يرجى المحاولة مرة أخرى.');
            
            const submitBtn = document.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-shopping-cart ml-2"></i> اشتري الآن';
            submitBtn.disabled = false;
        }
    });
});
